<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="3D PDF Editor with preview, formatted notes, and multi-theme support for students and professionals.">
    <meta name="keywords" content="3D PDF editor, formatted notes, file handling, Python notes, PDF preview, multi-theme">
    <meta name="robots" content="index, follow">
    <meta name="author" content="xAI">
    <title>3D PDF Editor - Formatted Notes with Preview</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #4f46e5;
            --background: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] {
            --primary: #818cf8;
            --secondary: #6366f1;
            --background: #1e293b;
            --text: #f8fafc;
            --border: #475569;
            --shadow: rgba(255, 255, 255, 0.1);
        }

        [data-theme="forest"] {
            --primary: #2d6a4f;
            --secondary: #1b4332;
            --background: #f0f7f4;
            --text: #081c15;
            --border: #95d5b2;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        [data-theme="sunset"] {
            --primary: #ff6b6b;
            --secondary: #f94144;
            --background: #fefae0;
            --text: #2b2d42;
            --border: #f4a261;
            --shadow: rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            color: var(--text);
            margin: 0;
            padding: 20px;
            transition: all 0.3s;
            perspective: 1000px; /* 3D effect ke liye */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            transform-style: preserve-3d;
            box-shadow: 0 10px 20px var(--shadow);
            border-radius: 15px;
            background: var(--background);
            padding: 20px;
        }

        .toolbar {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--background);
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
            flex-wrap: wrap;
            transform: translateZ(20px); /* 3D depth */
        }

        .btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px var(--shadow), inset 0 -2px 5px rgba(0, 0, 0, 0.2);
            transform: translateZ(10px);
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px) translateZ(15px);
            box-shadow: 0 8px 20px var(--shadow), inset 0 -2px 5px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(2px) translateZ(5px);
            box-shadow: 0 3px 10px var(--shadow);
        }

        .page-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
            transform: translateZ(10px);
        }

        .page-tab {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            background: var(--background);
            border: 2px solid var(--border);
            transition: all 0.3s;
            box-shadow: 0 3px 10px var(--shadow);
        }

        .page-tab.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
            transform: translateZ(5px);
        }

        .editor-container {
            margin-top: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--background);
            box-shadow: 0 5px 15px var(--shadow);
            transform: translateZ(5px);
        }

        .ql-toolbar {
            border: none !important;
            background: var(--background) !important;
            border-bottom: 1px solid var(--border) !important;
        }

        .ql-container {
            border: none !important;
            height: 600px;
            background: var(--background);
            color: var(--text);
        }

        .size-control, .theme-control {
            padding: 8px;
            border-radius: 6px;
            border: 2px solid var(--border);
            background: var(--background);
            color: var(--text);
            box-shadow: 0 3px 10px var(--shadow);
            transition: all 0.3s;
        }

        .size-control:hover, .theme-control:hover {
            transform: translateZ(5px);
        }

        .word-count {
            padding: 8px;
            color: var(--text);
            font-size: 14px;
            transform: translateZ(5px);
        }

        /* Removed .ads-container CSS */

        .preview-container {
            margin-top: 20px;
            padding: 20px;
            border: 2px dashed var(--border);
            background: var(--background);
            display: none;
            box-shadow: 0 5px 15px var(--shadow);
            transform: translateZ(5px);
        }
    </style>
    <!-- Removed Google AdSense script -->
</head>
<body>
    <div class="container">
        <header>
            <h1 style="display: none;">3D PDF Editor with Preview</h1>
        </header>
        <div class="toolbar">
            <select class="size-control" id="pageSize">
                <option value="595,842">A4 (210×297mm)</option>
                <option value="612,792">Letter (8.5×11in)</option>
                <option value="612,1008">Legal (8.5×14in)</option>
            </select>
            <button class="btn" id="newPage">+ New Page</button>
            <button class="btn" id="exportPdf">Export PDF</button>
            <button class="btn" id="previewPdf">Preview PDF</button>
            <button class="btn" id="sampleNotes">Add Sample Notes</button>
            <select class="theme-control" id="themeSelect">
                <option value="light">Light Theme</option>
                <option value="dark">Dark Theme</option>
                <option value="forest">Forest Theme</option>
                <option value="sunset">Sunset Theme</option>
            </select>
            <span class="word-count" id="wordCount">Words: 0</span>
        </div>

        <!-- Removed Ads Container -->

        <div class="page-tabs" id="pageTabs"></div>

        <div class="editor-container" id="editorContainer"></div>
        <div class="preview-container" id="previewContainer"></div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script>
        const { PDFDocument, StandardFonts, rgb } = PDFLib;

        class PDFEditor {
            constructor() {
                this.editors = [];
                this.currentPage = 0;
                this.editorContainer = document.getElementById('editorContainer');
                this.pageTabs = document.getElementById('pageTabs');
                this.wordCountElement = document.getElementById('wordCount');
                this.themeSelect = document.getElementById('themeSelect');
                this.previewContainer = document.getElementById('previewContainer');
                this.initEventListeners();
                // Create the first page on load
                this.createNewPage();
            }

            createNewPage() {
                const editorDiv = document.createElement('div');
                editorDiv.className = 'editor';
                // Initially hide new editors until they are switched to
                editorDiv.style.display = 'none';
                const editorId = `editor-${this.editors.length}`;
                editorDiv.id = editorId;
                this.editorContainer.appendChild(editorDiv);

                const quill = new Quill(`#${editorId}`, {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            [{ 'align': [] }],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'size': ['small', false, 'large', 'huge'] }],
                            ['link', 'image'], // Image handling in PDF-Lib drawText requires separate implementation, will be skipped in PDF output for simplicity
                            ['clean']
                        ]
                    }
                });

                // Store editor instance, current size setting for the page, and content
                this.editors.push({
                    editor: quill,
                    size: document.getElementById('pageSize').value.split(',').map(Number),
                    // Store Delta content, not just plain text
                    content: quill.getContents()
                });

                quill.on('text-change', () => {
                    // Update content storage and word count when text changes in the active editor
                    this.editors[this.currentPage].content = this.editors[this.currentPage].editor.getContents();
                    this.updateWordCount();
                });

                this.updatePageTabs();
                // Switch to the newly created page
                this.switchPage(this.editors.length - 1);
            }

            updatePageTabs() {
                this.pageTabs.innerHTML = this.editors.map((_, i) =>
                    `<div class="page-tab ${i === this.currentPage ? 'active' : ''}"
                          data-page="${i}">Page ${i + 1}</div>`
                ).join('');

                this.pageTabs.querySelectorAll('.page-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchPage(parseInt(tab.dataset.page)));
                });
            }

            switchPage(index) {
                // Save content of the current page before switching
                this.editors[this.currentPage].content = this.editors[this.currentPage].editor.getContents();

                // Hide all editors
                this.editorContainer.querySelectorAll('.editor').forEach((editor) => {
                    editor.style.display = 'none';
                });

                // Show the target editor and load its content
                this.currentPage = index;
                const targetEditorDiv = document.getElementById(`editor-${index}`);
                targetEditorDiv.style.display = 'block';
                this.editors[index].editor.setContents(this.editors[index].content);

                // Ensure cursor is visible and focused
                this.editors[index].editor.focus();

                this.updatePageTabs();
                this.updateWordCount();

                // Update the page size dropdown to reflect the current page's size setting
                const [width, height] = this.editors[index].size;
                document.getElementById('pageSize').value = `${width},${height}`;
            }

            updateWordCount() {
                // Get plain text from the current editor to count words
                const text = this.editors[this.currentPage].editor.getText().trim();
                const words = text.split(/\s+/).filter(word => word.length > 0).length;
                this.wordCountElement.textContent = `Words: ${words}`; // Removed the limit text
            }

            addSampleNotes() {
                const sampleContent = `# CSV Files
- CSV (Comma Separated Values) is a text file where data is separated by commas.
- The 'csv' module is used to handle it in Python.
Example:
\`\`\`python
import csv
with open("data.csv", "r") as f:
    reader = csv.reader(f)
    for row in reader:
        print(row)
\`\`\`

## Reading and Writing
CSV files can be read row by row or written row by row.

**Reading:** Use \`csv.reader\`.
**Writing:** Use \`csv.writer\`. Remember to handle newlines (\`newline=''\`).

*Important Consideration:* Encoding! Always specify encoding like \`utf-8\`.

Size mapping in PDF:
- Small text
- Normal text (default)
- Large text
- Huge text

Different colors:
- Red text
- Blue text
`; // Added more diverse sample content for testing formatting

                const delta = this.editors[this.currentPage].editor.clipboard.convert({ html: sampleContent });
                this.editors[this.currentPage].editor.setContents(delta);
                this.updateWordCount();
            }

            initEventListeners() {
                document.getElementById('newPage').addEventListener('click', () => this.createNewPage());
                document.getElementById('exportPdf').addEventListener('click', () => this.generatePDF(false));
                document.getElementById('previewPdf').addEventListener('click', () => this.generatePDF(true));
                document.getElementById('sampleNotes').addEventListener('click', () => this.addSampleNotes());

                this.themeSelect.addEventListener('change', (e) => {
                    document.body.setAttribute('data-theme', e.target.value);
                });

                document.getElementById('pageSize').addEventListener('change', (e) => {
                    // Update the size for the currently active page
                    this.editors[this.currentPage].size = e.target.value.split(',').map(Number);
                    // Optional: Could re-render preview or adjust editor appearance if needed, but just saving the size is enough for PDF export
                });
            }
            --- START OF FILE text-to-pdf-generator-modified-part4.html ---
                // PDF saving/previewing logic
                const pdfBytes = await pdfDoc.save();
                if (preview) {
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    // Use an iframe to display the PDF preview
                    this.previewContainer.innerHTML = `<iframe src="${url}" width="100%" height="500px"></iframe>`;
                    this.previewContainer.style.display = 'block';
                    console.log("Preview generated. Displaying in iframe.");
                } else {
                    // Create a download link for the PDF
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    // Set a default filename based on date
                    link.download = `formatted-notes-${new Date().toISOString().split('T')[0]}.pdf`;
                    // Programmatically click the link to trigger the download
                    link.click();
                    // Clean up the object URL after download starts (or a short delay)
                    URL.revokeObjectURL(url);
                    console.log("PDF download initiated.");
                     // Hide preview if it was showing
                    this.previewContainer.style.display = 'none';
                }
            }

            // Helper function placeholders (defined earlier in Part 3 for flow)
            // getFont(attributes) { ... }
            // getFontSize(attributes) { ... }
            // getColor(attributes) { ... }
            // getTextWidth(text, font, size) { ... }
            // drawWrappedText(page, text, x, y, maxWidth, font, size, color, lineHeight) { ... }

        } // End of PDFEditor class


        // Initialize the editor once the DOM is ready
        const editor = new PDFEditor();

         // Optional: Load theme preference from local storage on page load
         const savedTheme = localStorage.getItem('theme');
         if (savedTheme) {
             document.body.setAttribute('data-theme', savedTheme);
             document.getElementById('themeSelect').value = savedTheme;
         }
         // Save theme preference when changed
         document.getElementById('themeSelect').addEventListener('change', (e) => {
             localStorage.setItem('theme', e.target.value);
         });

         // Optional: Load page size preference from local storage on page load
         const savedPageSize = localStorage.getItem('pageSize');
         if (savedPageSize) {
             document.getElementById('pageSize').value = savedPageSize;
             // Update the size for the initial page if it exists
             if(editor.editors.length > 0) {
                 editor.editors[0].size = savedPageSize.split(',').map(Number);
             }
         }
         // Save page size preference when changed
         document.getElementById('pageSize').addEventListener('change', (e) => {
             localStorage.setItem('pageSize', e.target.value);
         });


    </script>
</body>
</html>
